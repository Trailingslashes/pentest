#!/bin/bash

if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <url>"
    exit 1
fi

# Install chromium for gowitness
echo "[+] Installing chromium for gowitness..."
apt install chromium

# An array of the tools and their install instructions
declare -A tools
tools=(
    ["assetfinder"]="assetfinder could not be found, install via apt - sudo apt install assetfinder"
    ["httprobe"]="httprobe could not be found, install via apt - sudo apt install httprobe"
    ["amass"]="amass could not be found, install via apt - sudo apt install amass"
		["gowitness"]="gowitness could not be found, install via go - go install github.com/sensepost/gowitness@latest"
)

# Loop through the array and check if each tool is installed
for tool in "${!tools[@]}"; do
    if ! command -v $tool &> /dev/null; then
        echo "${tools[$tool]}"
        exit
    fi
done

url=$1

if [ ! -d "$url" ]; then 
    mkdir $url
fi

if [ ! -d "$url/recon" ]; then
    mkdir $url/recon
fi

echo "[+] Harvesting subdomains with assetfinder..."
assetfinder $url >> $url/recon/assets.txt

cat $url/recon/assets.txt | grep $1 >> $url/recon/final.txt
rm $url/recon/assets.txt

echo "[+] Harvesting subdomains with amass..."
amass enum -passive -d $url >> $url/recon/f.txt
sort -u $url/recon/f.txt >> $url/recon/final.txt
rm $url/recon/f.txt

echo "[+] Checking if sites are alive..."
cat $url/recon/final.txt | sort -u |  httprobe -s -p https:443 | sed 's/https\?:\/\///' | tr -d ':443' >> $url/recon/alive.txt

echo "[+] Taking screenshots..."
gowitness file -f $url/recon/alive.txt --timeout 10

echo "[+] Done"
